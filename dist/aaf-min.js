angular.module("aaf",["ngRoute","pouchdb"]),angular.module("aaf").provider("entityReference",function(){var a=null;this.setDbName=function(b){a=b},this.$get=["pouchDB","$log","$q",function(b,c,d){var e=b(a),f=function(a){c.log("EntityReference.get(%o)",a);var b=e.get(a).then(function(a){return a}).catch(function(a){c.console.error(a)});return b},g=function(a,b,d){b="undefined"!=typeof b?b:["_id","name"],d="undefined"!=typeof d?d:["name"],c.log("EntityReference.find(%o, %o, %o)",a,b,d);var f={itemType:a};for(var g in d){var h=d[g];f[h]={$gte:""}}c.debug("selector: %o",f);var i=e.find({selector:f,fields:b,sort:d}).then(function(a){return a}).catch(function(a){c.error(a)});return i},h=function(a,b){c.log("EntityReference.store(%o, %o)",a,b),a.itemType=b;var d=e.post(a).then(function(a){return c.debug("result: %o",a),f(a.id)}).catch(function(a){c.error(a)});return d},i=function(a){c.log("EntityReference.remove(%o)",a);var b=null;if(a._id)b=e.remove(a).catch(function(a){c.error(a)});else{var g=[];for(var h in a){var i=a[h];g.push(f(i).then(function(a){return e.remove(a)}).catch(function(a){c.error(a)}))}b=d.all(g)}return b};return{get:f,find:g,store:h,remove:i}}]}),angular.module("aaf").controller("EntityReferenceItemController",["$location","$log","reference","$scope","$routeParams",function(a,b,c,d,e){b.log("EntityReferenceItemController"),b.log("$routeParams: %o",e),d.item={},e.itemId&&c.get(e.itemId).then(function(a){d.item=a}),d.storeItem=function(){b.log("EntityReferenceItemController.store()"),b.debug("$scope.item = %o",d.item),c.store(d.item).then(function(a){b.debug("result = %o",a),d.close()}).catch(function(a){b.error(a)})},d.removeItem=function(){b.log("EntityReferenceItemController.removeItem()"),b.debug("$scope.item: %o",d.item),c.remove(d.item).then(function(a){d.close()}).catch(function(a){b.error(a)})},d.close=function(){a.path("/"+c.getItemType())}}]),angular.module("aaf").controller("EntityReferenceListController",["$scope","$log","reference","$location",function(a,b,c,d){b.log("EntityReferenceListController"),a.items=[];var e=function(){b.log("EntityReferenceListController.init()"),c.find().then(function(c){b.debug("result = %o",c),a.items=c.docs}).catch(function(a){b.error(a)})};e(),a.editItem=function(a){d.path("/"+c.getItemType()+"/item/"+a._id)},a.selectAll=!1,a.selected=[],a.toggle=function(){for(var b in a.items)a.selected[b]=a.selectAll},a.removeItems=function(){b.log("EntityReferenceListController.removeItems()");var d=[];for(var f in a.selected)d.push(a.items[f]._id);d.length>0&&c.remove(d).then(function(b){a.selectAll=!1,a.selected.length=0,e()}).catch(function(a){b.error(a)})}}]);
//# sourceMappingURL=aaf-min.js.map